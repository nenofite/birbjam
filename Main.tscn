[gd_scene load_steps=10 format=2]

[ext_resource path="res://maps/map1.tscn" type="PackedScene" id=1]
[ext_resource path="res://Bird.tscn" type="PackedScene" id=2]
[ext_resource path="res://Selector.tscn" type="PackedScene" id=3]
[ext_resource path="res://Selection.gd" type="Script" id=4]
[ext_resource path="res://Tower.tscn" type="PackedScene" id=5]
[ext_resource path="res://Rocks.gd" type="Script" id=6]

[sub_resource type="GDScript" id=1]
script/source = "extends Navigation2D

func _unhandled_input(event):
	if event.is_action_pressed(\"move_to\"):
		var selected := $\"/root/Main/Selection\".current as Bird
		if !selected: return
		if selected.is_moving(): return
		get_tree().set_input_as_handled()
		var mouse := get_global_mouse_position()
		var spos := selected.global_position
		var points := get_simple_path(spos, mouse, false)
		if points.size() > 1:
			selected.start_path(points)
			hide_path()
	elif event is InputEventMouseMotion:
		var selected := $\"/root/Main/Selection\".current as Bird
		if !selected: return
		if selected.is_moving(): return
		var mouse := get_global_mouse_position()
		var spos := selected.global_position
		var points := get_simple_path(spos, mouse, false)
		if points.size() > 1:
			show_path(points)
		else:
			hide_path()
			
func hide_path() -> void:
	Util.clear_children($\"../Dots\")

func show_path(points: Array) -> void:
	hide_path()
	var dots := $\"../Dots\"
	if points.size() <= 1: return
	for i in range(1, points.size()):
		var p := points[i] as Vector2
		var dot := preload(\"res://Dot.tscn\").instance() as Node2D
		dots.add_child(dot)
		dot.global_position = p
"

[sub_resource type="RectangleShape2D" id=2]
extents = Vector2( 64, 32 )

[sub_resource type="RectangleShape2D" id=3]
extents = Vector2( 16, 16 )

[node name="Main" type="Node2D"]
__meta__ = {
"_edit_lock_": true
}

[node name="Selection" type="Node" parent="."]
script = ExtResource( 4 )

[node name="Navigation2D" type="Navigation2D" parent="."]
cell_size = 32.0
edge_connection_margin = 32.0
script = SubResource( 1 )

[node name="Map1" parent="Navigation2D" instance=ExtResource( 1 )]

[node name="Bird" parent="." instance=ExtResource( 2 )]
position = Vector2( 80, 80 )

[node name="Selector" parent="." instance=ExtResource( 3 )]
visible = false

[node name="Dots" type="Node2D" parent="."]

[node name="Tower" parent="." instance=ExtResource( 5 )]

[node name="Rocks" type="Node2D" parent="."]
position = Vector2( 800, 448 )
script = ExtResource( 6 )

[node name="InteractionArea" type="Area2D" parent="Rocks"]
collision_layer = 2
collision_mask = 0

[node name="CollisionShape2D" type="CollisionShape2D" parent="Rocks/InteractionArea"]
shape = SubResource( 2 )

[node name="CollisionShape2D2" type="CollisionShape2D" parent="Rocks/InteractionArea"]
position = Vector2( 80, -16 )
shape = SubResource( 3 )
